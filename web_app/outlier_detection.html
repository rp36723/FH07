<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Posture Sensor Outlier Analysis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 20px;
      background: #020617;
      color: #e5e7eb;
    }

    h1 {
      margin-top: 0;
      font-size: 1.6rem;
    }

    .card {
      max-width: 900px;
      margin: 0 auto;
      background: #0b1220;
      border-radius: 16px;
      padding: 20px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.45);
    }

    .subtitle {
      font-size: 0.9rem;
      color: #9ca3af;
      margin-bottom: 14px;
    }

    .summary {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 16px;
      font-size: 0.85rem;
    }

    .stat-card {
      background: #020617;
      border-radius: 10px;
      padding: 8px 10px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      min-width: 170px;
    }

    .stat-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 0.85rem;
    }

    th, td {
      padding: 6px 8px;
      text-align: center;
    }

    th {
      background: #020617;
      border-bottom: 1px solid rgba(55, 65, 81, 0.9);
      color: #9ca3af;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    tr:nth-child(even) td {
      background: rgba(15, 23, 42, 0.8);
    }

    .outlier {
      background: rgba(185, 28, 28, 0.25) !important;
      color: #fecaca;
      font-weight: 600;
    }

    .badge {
      display: inline-block;
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.7rem;
      margin-left: 4px;
    }

    .badge-outlier {
      background: rgba(248, 113, 113, 0.15);
      border: 1px solid rgba(248, 113, 113, 0.7);
      color: #fecaca;
    }

    .badge-normal {
      background: rgba(22, 163, 74, 0.12);
      border: 1px solid rgba(22, 163, 74, 0.8);
      color: #bbf7d0;
    }

    .legend {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-top: 10px;
    }

    .legend span {
      margin-right: 10px;
    }

    code {
      background: rgba(15, 23, 42, 0.9);
      padding: 2px 4px;
      border-radius: 4px;
      font-size: 0.8rem;
    }

    .scroll-container {
      max-height: 380px;
      overflow-y: auto;
      border-radius: 12px;
      border: 1px solid rgba(31, 41, 55, 0.8);
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Posture Sensor Outlier Analysis</h1>
    <p class="subtitle">
      This risk–reduction prototype analyzes simulated posture readings for three sensors
      (upper, mid, and lower back). It computes the mean and standard deviation for each sensor and
      flags values that are more than 2&nbsp;σ from the mean as outliers.
      This lets us validate simple anomaly-detection logic before we have real hardware.
    </p>

    <div class="summary" id="summary"></div>

    <div class="scroll-container">
      <table>
        <thead>
          <tr>
            <th>Sample #</th>
            <th>Upper back</th>
            <th>Mid back</th>
            <th>Lower back</th>
          </tr>
        </thead>
        <tbody id="table-body"></tbody>
      </table>
    </div>

    <div class="legend">
      <span><span class="badge badge-normal">normal</span> within 2σ of mean</span>
      <span><span class="badge badge-outlier">outlier</span> &gt; 2σ away from mean</span>
    </div>
  </div>

  <script>
    // --- Simulated sensor data (e.g., angle or distance measurements) ---
    // Each entry is one time step with three sensor readings.
    const readings = [
      { upper: 10.2, mid: 9.9,  lower: 11.1 },
      { upper: 10.4, mid: 10.1, lower: 11.0 },
      { upper: 10.1, mid: 10.2, lower: 11.3 },
      { upper: 10.3, mid: 9.8,  lower: 11.2 },
      { upper: 10.2, mid: 10.0, lower: 11.1 },
      { upper: 10.1, mid: 10.2, lower: 11.0 },
      { upper: 10.3, mid: 9.9,  lower: 11.4 },
      { upper: 10.2, mid: 10.1, lower: 11.2 },
      // a few intentionally weird values (outliers)
      { upper: 13.8, mid: 15.0, lower: 4.2  },
      { upper: 9.9,  mid: 10.0, lower: 11.0 },
      { upper: 10.0, mid: 9.7,  lower: 11.1 },
      { upper: 10.4, mid: 10.3, lower: 11.3 },
      { upper: 10.1, mid: 9.8,  lower: 11.2 },
      { upper: 16.5, mid: 10.2, lower: 11.0 }, // big spike on upper back
      { upper: 10.2, mid: 3.5,  lower: 11.1 }, // drop on mid back
      { upper: 10.3, mid: 10.1, lower: 18.0 }  // spike on lower back
    ];

    function mean(values) {
      return values.reduce((sum, v) => sum + v, 0) / values.length;
    }

    function stdDev(values, mu) {
      const variance =
        values.reduce((sum, v) => sum + Math.pow(v - mu, 2), 0) / values.length;
      return Math.sqrt(variance);
    }

    // Extract each sensor series
    const upperSeries = readings.map(r => r.upper);
    const midSeries   = readings.map(r => r.mid);
    const lowerSeries = readings.map(r => r.lower);

    const upperMean = mean(upperSeries);
    const midMean   = mean(midSeries);
    const lowerMean = mean(lowerSeries);

    const upperStd = stdDev(upperSeries, upperMean);
    const midStd   = stdDev(midSeries, midMean);
    const lowerStd = stdDev(lowerSeries, lowerMean);

    const thresholds = {
      upper: { mean: upperMean, std: upperStd },
      mid:   { mean: midMean,   std: midStd   },
      lower: { mean: lowerMean, std: lowerStd }
    };

    function isOutlier(sensor, value) {
      const { mean, std } = thresholds[sensor];
      return Math.abs(value - mean) > 2 * std;
    }

    // Populate summary stats
    function format(num) {
      return num.toFixed(2);
    }

    const summary = document.getElementById("summary");
    summary.innerHTML = `
      <div class="stat-card">
        <div class="stat-title">Upper back</div>
        <div>mean: ${format(upperMean)}</div>
        <div>σ: ${format(upperStd)}</div>
      </div>
      <div class="stat-card">
        <div class="stat-title">Mid back</div>
        <div>mean: ${format(midMean)}</div>
        <div>σ: ${format(midStd)}</div>
      </div>
      <div class="stat-card">
        <div class="stat-title">Lower back</div>
        <div>mean: ${format(lowerMean)}</div>
        <div>σ: ${format(lowerStd)}</div>
      </div>
    `;

    // Populate table
    const tbody = document.getElementById("table-body");

    readings.forEach((r, index) => {
      const row = document.createElement("tr");

      const sampleCell = document.createElement("td");
      sampleCell.textContent = index + 1;
      row.appendChild(sampleCell);

      ["upper", "mid", "lower"].forEach(sensor => {
        const value = r[sensor];
        const td = document.createElement("td");
        const out = isOutlier(sensor, value);

        td.textContent = value.toFixed(2);
        if (out) {
          td.classList.add("outlier");
          td.innerHTML += ' <span class="badge badge-outlier">outlier</span>';
        } else {
          td.innerHTML += ' <span class="badge badge-normal">normal</span>';
        }
        row.appendChild(td);
      });

      tbody.appendChild(row);
    });
  </script>
</body>
</html>
